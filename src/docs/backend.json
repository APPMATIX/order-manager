
{
  "entities": {
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client in the B2B order management system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Client entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the client."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email address for the client.",
          "format": "email"
        },
        "deliveryAddress": {
          "type": "string",
          "description": "The delivery address of the client."
        },
        "creditLimit": {
          "type": "number",
          "description": "The credit limit for the client."
        },
        "defaultPaymentTerms": {
          "type": "string",
          "description": "The default payment terms for the client (e.g., Net 30, COD)."
        },
        "trn": {
          "type": "string",
          "description": "The Tax Registration Number of the client."
        }
      },
      "required": [
        "id",
        "name",
        "contactEmail",
        "deliveryAddress",
        "creditLimit",
        "defaultPaymentTerms"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the product catalog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "sku": {
          "type": "string",
          "description": "A user-friendly, generated stock keeping unit (SKU) for the product (e.g., SKU-APP-001)."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "unit": {
          "type": "string",
          "description": "The unit of measurement for the product (e.g., KG, Box, Crate)."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        }
      },
      "required": [
        "id",
        "sku",
        "name",
        "unit",
        "price"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the order (e.g., Pending, Accepted, In Transit, Delivered)."
        },
        "paymentStatus": {
          "type": "string",
          "description": "The payment status of the order (e.g., Unpaid, Invoiced, Paid, Overdue)."
        },
        "paymentMethod": {
          "type": "string",
          "description": "The payment method used for the order."
        },
        "subTotal": {
          "type": "number",
          "description": "The subtotal amount of the order before VAT."
        },
        "vatAmount": {
          "type": "number",
          "description": "The VAT amount for the order."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "invoiceType": {
          "type": "string",
          "description": "The type of invoice for the order.",
          "enum": [
            "Normal",
            "VAT"
          ]
        }
      },
      "required": [
        "id",
        "clientId",
        "orderDate",
        "status",
        "paymentStatus",
        "subTotal",
        "vatAmount",
        "totalAmount",
        "invoiceType"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents a line item in an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OrderItem entity."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product in the order item."
        },
        "unitPrice": {
          "type": "number",
          "description": "The unit price of the product in the order item."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount for this order item (quantity * unitPrice)."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "unitPrice",
        "totalAmount"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the B2B order management system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "userType": {
          "type": "string",
          "description": "The type of user.",
          "enum": [
            "vendor",
            "admin"
          ]
        },
        "companyName": {
          "type": "string",
          "description": "The name of the user's company or their full name."
        },
        "trn": {
          "type": "string",
          "description": "The Tax Registration Number of the vendor."
        },
        "address": {
            "type": "string",
            "description": "The physical address of the vendor's company."
        },
        "billingAddress": {
            "type": "string",
            "description": "The billing address for the vendor."
        },
        "phone": {
            "type": "string",
            "description": "The contact phone number for the vendor."
        },
        "website": {
            "type": "string",
            "description": "The vendor's company website.",
            "format": "uri"
        },
        "photoURL": {
            "type": "string",
            "description": "URL of the user's profile picture, stored as a data URI.",
            "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user account was created."
        }
      },
      "required": [
        "id",
        "email",
        "userType"
      ]
    },
    "PurchaseBill": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseBill",
      "type": "object",
      "description": "Represents a purchase bill to track cost-of-goods-sold (COGS).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseBill entity."
        },
        "vendorName": {
          "type": "string",
          "description": "Name of the vendor from whom the goods were purchased."
        },
        "vendorTrn": {
          "type": "string",
          "description": "The Tax Registration Number of the vendor."
        },
        "vendorAddress": {
          "type": "string",
          "description": "The address of the vendor."
        },
        "vendorPhone": {
          "type": "string",
          "description": "The phone number of the vendor."
        },
        "billDate": {
          "type": "string",
          "description": "The date of the purchase bill.",
          "format": "date-time"
        },
        "subTotal": {
          "type": "number",
          "description": "The subtotal amount of the purchase bill before VAT."
        },
        "vatAmount": {
          "type": "number",
          "description": "The VAT amount for the purchase bill."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the purchase bill."
        },
        "lineItems": {
          "type": "array",
          "description": "List of items purchased.",
          "items": {
            "type": "object",
            "properties": {
              "itemName": {
                "type": "string"
              },
              "unit": {
                "type": "string"
              },
              "quantity": {
                "type": "number"
              },
              "costPerUnit": {
                "type": "number"
              }
            },
            "required": [
              "itemName",
              "quantity",
              "costPerUnit"
            ]
          }
        }
      },
      "required": [
        "id",
        "vendorName",
        "billDate",
        "subTotal",
        "vatAmount",
        "totalAmount",
        "lineItems"
      ]
    },
    "SignupToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SignupToken",
      "type": "object",
      "description": "Represents a one-time token for creating an admin or vendor account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique token string."
        },
        "role": {
          "type": "string",
          "description": "The role the token is for.",
          "enum": ["vendor", "admin"]
        },
        "status": {
          "type": "string",
          "description": "The status of the token.",
          "enum": ["active", "used", "expired"]
        },
        "createdBy": {
          "type": "string",
          "description": "The UID of the admin who created the token."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the token was created."
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the token will expire."
        },
        "usedBy": {
          "type": "string",
          "description": "The UID of the user who used the token."
        },
        "usedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the token was used."
        }
      },
      "required": ["id", "role", "status", "createdBy", "createdAt", "expiresAt"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection for storing user profiles. This collection is primarily used to store user account details. It acts as the root for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Collection for storing client information. This is user-owned data (1:N relationship) secured via path-based rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (vendor)."
            },
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Collection for storing product catalog information. This is user-owned data (1:N relationship) secured via path-based rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (vendor)."
            },
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Collection for storing order information. This is user-owned data (1:N relationship) secured via path-based rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (vendor)."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Subcollection for storing order items within an order.  Secured via hierarchical path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (vendor)."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchase_bills/{purchaseBillId}",
        "definition": {
          "entityName": "PurchaseBill",
          "schema": {
            "$ref": "#/backend/entities/PurchaseBill"
          },
          "description": "Collection for storing purchase bills to track cost-of-goods-sold (COGS). This is user-owned data secured via path-based rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (vendor)."
            },
            {
              "name": "purchaseBillId",
              "description": "The unique identifier for the purchase bill."
            }
          ]
        }
      },
      {
        "path": "/signup_tokens/{tokenId}",
        "definition": {
          "entityName": "SignupToken",
          "schema": {
            "$ref": "#/backend/entities/SignupToken"
          },
          "description": "Collection for storing one-time admin signup tokens. Restricted access.",
          "params": [
            {
              "name": "tokenId",
              "description": "The unique token string."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support a B2B order management system, focusing on secure data access, scalability, and maintainability for a single vendor. Authorization Independence is achieved by using path-based ownership (`/users/{userId}/...`) for all private data. This eliminates the need for `get()` calls in security rules, allowing for atomic operations. Structural Segregation is enforced by storing different data types (clients, products, orders, and order items) in separate collections. The structure supports the required QAPs by leveraging segregation and path-based ownership ensuring that `list` operations can be secured without filtering data based on content."
  }
}
